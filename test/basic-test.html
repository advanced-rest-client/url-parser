<!doctype html>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>
    <link rel="import" href="../url-parser.html">
  </head>
  <body>

    <script>
    // ${variable}://host

    /* global assert */
    suite('parser', function() {

      suite('properties parser', function() {
        var basics = [{
          url: 'http://domain.com',
          protocol: 'http:',
          host: 'domain.com',
          path: '/',
          search: undefined,
          anchor: undefined
        }, {
          url: 'http://domain.com/path',
          protocol: 'http:',
          host: 'domain.com',
          path: '/path',
          search: undefined,
          anchor: undefined
        }, {
          url: 'http://domain.com/path/endpoint',
          protocol: 'http:',
          host: 'domain.com',
          path: '/path/endpoint',
          search: undefined,
          anchor: undefined
        }, {
          url: 'http://domain.com/path/endpoint?param',
          protocol: 'http:',
          host: 'domain.com',
          path: '/path/endpoint',
          search: 'param',
          anchor: undefined
        }, {
          url: 'http://domain.com/path/endpoint?param=value',
          protocol: 'http:',
          host: 'domain.com',
          path: '/path/endpoint',
          search: 'param=value',
          anchor: undefined
        }, {
          url: 'http://domain.com/path/endpoint?param=value&other',
          protocol: 'http:',
          host: 'domain.com',
          path: '/path/endpoint',
          search: 'param=value&other',
          anchor: undefined
        }, {
          url: 'http://domain.com/path/endpoint?param=value&other=value#123',
          protocol: 'http:',
          host: 'domain.com',
          path: '/path/endpoint',
          search: 'param=value&other=value',
          anchor: '123'
        }, {
          url: 'http://domain.com/path/endpoint?${variable}=value&other=value',
          protocol: 'http:',
          host: 'domain.com',
          path: '/path/endpoint',
          search: '${variable}=value&other=value',
          anchor: undefined
        }, {
          url: 'http://domain.com/path/endpoint?param=${variable}&other=value',
          protocol: 'http:',
          host: 'domain.com',
          path: '/path/endpoint',
          search: 'param=${variable}&other=value',
          anchor: undefined
        }, {
          url: '${variable}',
          protocol: undefined,
          host: '${variable}',
          path: '/',
          search: undefined,
          anchor: undefined
        }, {
          url: 'http://domain.com/${variable}',
          protocol: 'http:',
          host: 'domain.com',
          path: '/${variable}',
          search: undefined,
          anchor: undefined
        }, {
          url: 'http://domain${variable}',
          protocol: 'http:',
          host: 'domain${variable}',
          path: '/',
          search: undefined,
          anchor: undefined
        }, {
          url: 'http://domain${variable}/',
          protocol: 'http:',
          host: 'domain${variable}',
          path: '/',
          search: undefined,
          anchor: undefined
        }, {
          url: '${variable}://',
          protocol: '${variable}:',
          host: undefined,
          path: '/',
          search: undefined,
          anchor: undefined
        }, {
          url: '${variable}://host',
          protocol: '${variable}:',
          host: 'host',
          path: '/',
          search: undefined,
          anchor: undefined
        }, {
          url: '',
          protocol: undefined,
          host: undefined,
          path: '/',
          search: undefined,
          anchor: undefined
        }, {
          url: '${variable}://${variable}:${variable}/${var}',
          protocol: '${variable}:',
          host: '${variable}:${variable}',
          path: '/${var}',
          search: undefined,
          anchor: undefined
        }];

        basics.forEach(function(item) {
          test('Parsing properties for: ' + item.url, function() {
            var parser = new UrlParser(item.url);

            assert.equal(parser.protocol, item.protocol, 'Protocol equals ' + item.protocol);
            assert.equal(parser.host, item.host, 'Host equals ' + item.host);
            assert.equal(parser.path, item.path, 'Path equals ' + item.path);
            assert.equal(parser.search, item.search, 'Search equals ' + item.search);
            assert.equal(parser.anchor, item.anchor, 'Anchor equals ' + item.anchor);
          });
        });
      });

      suite('search params parser', function() {
        var basics = [{
          url: 'http://domain.com',
          params: []
        }, {
          url: 'http://domain.com/path/endpoint?param',
          params: [['param', '']]
        }, {
          url: 'http://domain.com/path/endpoint?param=value',
          params: [['param', 'value']]
        }, {
          url: 'http://domain.com/path/endpoint?param=value&other',
          params: [['param', 'value'], ['other', '']]
        }, {
          url: 'http://domain.com/path/endpoint?param=value&other=value#123',
          params: [['param', 'value'], ['other', 'value']]
        }, {
          url: 'http://domain.com/path/endpoint?${variable}=value&other=value',
          params: [['${variable}', 'value'], ['other', 'value']]
        }, {
          url: 'http://domain.com/path/endpoint?param=${variable}&other=value',
          params: [['param', '${variable}'], ['other', 'value']]
        }, {
          url: '${variable}://${variable}:${variable}/${var}?${param}',
          params: [['${param}', '']]
        }];

        basics.forEach(function(item) {
          test('Parsing search params for: ' + item.url, function() {
            var parser = new UrlParser(item.url);
            assert.deepEqual(parser.searchParams, item.params);
          });
        });
      });

      suite('search params setter', function() {
        var basics = [{
          url: 'http://domain.com',
          result: 'http://domain.com/?test-param=param-value'
        }, {
          url: 'http://domain.com/path/endpoint?param',
          result: 'http://domain.com/path/endpoint?param=&test-param=param-value'
        }, {
          url: 'http://domain.com/path/endpoint?param=value',
          result: 'http://domain.com/path/endpoint?param=value&test-param=param-value'
        }, {
          url: 'http://domain.com/path/endpoint?param=value&other',
          result: 'http://domain.com/path/endpoint?param=value&other=&test-param=param-value'
        }, {
          url: 'http://domain.com/path/endpoint?param=value&other=value#123',
          result: 'http://domain.com/path/endpoint?param=value&other=value&test-param=param-value#123'
        }, {
          url: 'http://domain.com/path/endpoint?${variable}=value&other=value',
          result: 'http://domain.com/path/endpoint?${variable}=value&other=value&test-param=param-value'
        }, {
          url: 'http://domain.com/path/endpoint?param=${variable}=&other=value',
          result: 'http://domain.com/path/endpoint?param=${variable}' +
            '&other=value&test-param=param-value'
        }, {
          url: '${variable}://${variable}:${variable}/${var}?${param}',
          result: '${variable}://${variable}:${variable}/${var}?${param}=&test-param=param-value'
        }];

        basics.forEach(function(item) {
          test('Parsing search params for: ' + item.url, function() {
            var parser = new UrlParser(item.url);
            var params = parser.searchParams;
            params.push(['test-param', 'param-value']);
            parser.searchParams = params;
            assert.equal(parser.value, item.result);
          });
        });
      });

      suite('toString()', function() {
        var basics = [{
          url: 'http://domain.com',
          result: 'http://domain.com/'
        }, {
          url: 'http://domain.com/path/endpoint?param',
          result: 'http://domain.com/path/endpoint?param='
        }, {
          url: 'http://domain.com/path/endpoint?param=value',
          result: 'http://domain.com/path/endpoint?param=value'
        }, {
          url: 'http://domain.com/path/endpoint?param=value&other',
          result: 'http://domain.com/path/endpoint?param=value&other='
        }, {
          url: 'http://domain.com/path/endpoint?param=value&other=value#123',
          result: 'http://domain.com/path/endpoint?param=value&other=value#123'
        }, {
          url: 'domain.com',
          result: 'domain.com/'
        }, {
          url: 'http://',
          result: 'http://'
        }, {
          url: '${variable}://',
          result: '${variable}://'
        }];

        basics.forEach(function(item) {
          test('Parsing url: ' + item.url, function() {
            var parser = new UrlParser(item.url);
            assert.equal(parser.value, item.result);
          });
        });
      });

    });
    </script>

  </body>
</html>
